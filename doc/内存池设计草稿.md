## 线程安全

程安全的内存池设计需要考虑多个线程同时访问内存池时可能会引发的竞争条件和数据一致性问题。常见的线程安全内存池设计包括以下几种：

1. 锁机制：在内存池的关键操作（如分配、释放内存）前后加锁以确保同一时间只有一个线程能够访问内存池。这种方法简单易行，但会导致性能瓶颈，并且容易产生死锁等问题。

2. 无锁算法：使用无锁算法实现内存池，例如基于 CAS (Compare and Swap) 的原子操作。这种方法可以提高并发性能，但对算法设计和实现要求较高，而且仍然存在 ABA 等问题。

3. **分离式内存池**：将内存池按照不同大小的内存块进行分离，每个线程都管理自己的内存池。当需要新的内存块时，先从本地内存池中分配，如果本地内存池已满，则从共享内存池中分配。这种方法可以减少锁竞争，提高并发性能，但需要注意内存池大小的调整和动态分配等问题。

4. 指针数组内存池：使用指针数组来管理内存块，每个线程都有自己的指针数组，并通过线程 ID 来索引数组。当需要内存时，线程先尝试从本地指针数组中分配内存，如果失败则从共享指针数组中分配。由于指针数组的长度是固定的，因此不存在锁竞争和动态内存分配等问题，但需要注意内存碎片和数组溢出等问题


分离式内存池

共享内存池：主要用于避免各个线程池持有的空闲内存太多而造成浪费
线程私有内存池：
    大块：
    小块：